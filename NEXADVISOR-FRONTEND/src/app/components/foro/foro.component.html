<div class="foro-container">
  <h2>Foro de Estudiantes</h2>

  <div class="formulario">
    <h3>Crear nueva publicación</h3>
    <input type="text" [(ngModel)]="nuevaPublicacion.titulo" placeholder="Título" />
    <textarea [(ngModel)]="nuevaPublicacion.contenido" placeholder="Contenido" rows="4"></textarea>
    <button (click)="publicar()">Publicar</button>
  </div>

  <hr />

  <div class="lista-publicaciones">
    <h3>Publicaciones recientes</h3>
    <div *ngFor="let pub of publicaciones" class="publicacion">
      <h4>{{ pub.titulo }}</h4>

      <!-- Protegido contra errores de fecha y nombre -->
      <p class="meta">
        Por {{ pub.estudiante?.nombre || 'Anónimo' }} -
        {{ pub.fechaPublicacion ? (pub.fechaPublicacion | date: 'short') : 'Sin fecha' }}
      </p>

      <!-- Protegido contra contenido undefined -->
      <p>{{ pub.contenido ? (pub.contenido | slice: 0:200) : '' }}...</p>

      <!-- Ver más solo si pub.id no es undefined -->
      <button *ngIf="pub.id != null" (click)="verDetalle(pub.id)">Ver más</button>

      <!-- Mostrar botón solo si pub.estudiante?.id y user.id coinciden -->
      <button
        class="eliminar"
        *ngIf="pub.id != null && pub.estudiante?.id === user.id"
        (click)="eliminar(pub.id)">
        Eliminar
      </button>
    </div>
  </div>
</div>
